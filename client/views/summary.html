<template name="work_summary">
  <section class="content report list">
    {{ > work_report id=this }}
  </section>
</template>

<template name="work_report">
  {{#if Template.subscriptionsReady}}
    {{#if report.error }}
      {{ console report.error }}
      <div class="report-error">Error ({{ report.error.error }}): {{ report.error.reason }}</div>
    {{/if}}
    {{#if report.result }}
      <header class="row">
        <div class="title">Reviews Report</div>
        <div class="share-twitter"></div>
        <div class="share-google"></div>
        <div class="share-facebook"></div>
        <div class="share-linkedin"></div>
      </header>
      {{ > work_info work=work score=workScore }}
      {{ > work_summary_reviews workId=id }}
      {{ > work_summary_requirements workId=id }}
    {{/if}}
  {{else}}
    <div class="report-loading">Loading...</div>
  {{/if}}
</template>

<template name="work_summary_reviews">
  {{#if Template.subscriptionsReady}}
    <section class="reviews-summary user-feedback-list">
    {{#if reports }}
      {{#each reports.result}}
      <article class="user-feedback {{reviewFeedbackStyle this}}">
        <div class="user">{{ getUserName user }}</div>
        <div class="score {{scoreRateClass score.rate}}">{{ score.earned }}</div>
        <div class="feedback">{{#markdown}}{{ feedback }}{{/markdown}}</div>
      </article>
      {{/each}}
    {{/if}}
    </section>
  {{else}}
    <h3>Loading...</h3>
  {{/if}}
</template>

<template name="work_summary_requirements">
  <section class="reviews-details">
    <header>
      <h4>Details</h4>
    </header>
    {{#if requirements }}
      {{#each requirements.result}}
        <article class="requirement summary">
          <header class="row widget requirement">
            <div class="row-id">{{sum @index 1 }}</div>
            <div class="title">{{ title }}</div>
            <div class="block earned-score small {{scoreRateClass rate}}">
              <span class="value">{{ rate }}</span>
              <span class="total">of {{ score }}</span>
            </div>
          </header>
          <div class="user-feedback-list">
            {{#each reviews}}
            <article class="user-feedback small {{requirementFeedbackStyle result}} size-{{ result.value }}">
              <div class="user">{{ getUserName user }}</div>
              <div class="score {{scoreRateClass result.value}}">{{ result.value }}</div>
              <div class="feedback">{{#markdown}}{{ result.comment }}{{/markdown}}</div>
            </article>
            {{/each}}
          </div>
        </article>
      {{/each}}
    {{/if}}
  </section>
</template>