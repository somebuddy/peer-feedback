<template name="work_summary">
  <section class="content report list">
    <header class="row">
      <div class="title">Reviews Report</div>
      <div class="share-twitter"></div>
      <div class="share-google"></div>
      <div class="share-facebook"></div>
      <div class="share-linkedin"></div>
    </header>
    {{ > work_summary_result }}

    {{ > work_summary_reviews workId=this._id }}
    {{ > work_summary_requirements workId=this._id }}

    {{ > work_reviews_details }}
  </section>
</template>

<template name="work_summary_result">
  {{ > work_info work=this score=workScore }}
</template>

<template name="work_summary_reviews">
  {{#if Template.subscriptionsReady}}
    <section class="reviews-summary user-feedback-list">
    {{#if reports }}
      {{#if reports.error }}
        <div class="alert alert-danger">{{ reports.error.message }}</div>
      {{/if}}

      {{#each reports.result}}
      <article class="user-feedback {{reviewFeedbackStyle this}}">
        <div class="user">{{ getUserName user }}</div>
        <div class="score {{scoreRate rate}}">{{ score.earned }}</div>
        <div class="feedback">{{#markdown}}{{ feedback }}{{/markdown}}</div>
      </article>
      {{/each}}
    {{/if}}
    </section>
  {{else}}
    <h3>Loading...</h3>
  {{/if}}
</template>

<template name="work_summary_requirements">
  <section class="reviews-details">
    <header>
      <h4>Details</h4>
    </header>
    {{#if requirements }}
      {{#if requirements.error }}
        <div class="alert alert-danger">{{ requirements.error }}</div>
      {{/if}}
      {{#each requirements.result}}
        <article class="requirement summary">
          <header class="row widget requirement">
            <div class="row-id">{{sum @index 1 }}</div>
            <div class="title">{{ title }}</div>
            <div class="block earned-score small {{requirementSummaryScoreRate rate}}">
              <span class="value">{{ rate }}</span>
              <span class="total">of {{ score }}</span>
            </div>
          </header>
          <div class="user-feedback-list">
            {{#each reviews}}
            <article class="user-feedback small {{requirementFeedbackStyle this}} size-{{ result.value }}">
              <div class="user">{{ getUserName user }}</div>
              <div class="score {{requirementScoreRate this}}">{{ result.value }}</div>
              <div class="feedback">{{#markdown}}{{ result.comment }}{{/markdown}}</div>
              <div class="feedback">{{ console result }}</div>
            </article>
            {{/each}}
          </div>
        </article>
      {{/each}}
    {{/if}}
  </section>
</template>

<template name="work_reviews_details">
  <section class="reviews-details">
    {{#each requirementsSummary}}
      <article class="requirement summary">
        <header class="row widget requirement">
          <div class="row-id">{{sum @index 1 }}</div>
          <div class="title">{{ title }}</div>
          <div class="block earned-score small {{requirementScoreRate this}}">
            <span class="value">{{ this.result }}</span>
            <span class="total">of {{ this.score }}</span>
          </div>
        </header>
        <div class="user-feedback-list">
          {{#each this.reviews}}
          <article class="user-feedback {{reviewFeedbackStyle this}} size-{{ this.result }}">
            <div class="user">{{ getUserName user }}</div>
            <div class="score {{requirementScoreRate this}}">{{ this.result }}</div>
            <div class="feedback">{{#markdown}}{{ this.feedback }}{{/markdown}}</div>
          </article>
          {{/each}}
        </div>
      </article>
    {{/each}}
  </section>
</template>